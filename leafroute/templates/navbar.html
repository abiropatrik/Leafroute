{% load static %}
<div class="navbar">
    <a href="{% url 'public:index' %}"><img src="{% static 'theme/img/logo-dark2.png' %}" alt="Logo" class="logo"/></a>
    <button class="hamburger-menu" onclick="toggleSidebar()">☰</button>
    <div class="auth-navbar">
        {% if user.is_authenticated %}
            <span>{{ user.first_name }} {{ user.last_name }}</span>
            <div class="dropdown">
                <img src="{% static 'theme/img/user_navbar_icon.png' %}" 
                     alt="User icon" 
                     class="user-icon"
                     onclick="toggleDropdown()" />

                <div id="userDropdown" class="dropdown-content">
                    <!--<a href="{% url 'account:profile' %}">Account</a> -->
                    <form method="get" action="{% url 'account:profile' %}">
                        <button type="submit">Account</button>
                    </form>

                    <form method="post" action="{% url 'account:logout' %}">
                        {% csrf_token %}
                        <button type="submit">Logout</button>
                    </form>
                </div>
            </div>
        {% else %}
            <span class="login-link">
                <a href="{% url 'account:login' %}" class="nav-link {% if request.resolver_match.url_name == 'login' %}active-link{% endif %}">Login</a>
            </span>
        {% endif %}
    </div>
</div>

<div id="sidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="toggleSidebar()">&times;</a>
    <a href="{% url 'public:index' %}" class="nav-link {% if request.resolver_match.url_name == 'index' %}active-link{% endif %}">Home</a>
    {% if user.is_authenticated %}
        <a href="{% url 'internal:workschedule' %}" class="nav-link {% if request.resolver_match.url_name == 'workschedule' %}active-link{% endif %}">Munkaidőm</a>
    {% endif %}
    {% if not user.is_authenticated %}
        <a href="{% url 'public:about' %}" class="nav-link {% if request.resolver_match.url_name == 'about' %}active-link{% endif %}">About</a>
        <a href="{% url 'public:contact' %}" class="nav-link {% if request.resolver_match.url_name == 'contact' %}active-link{% endif %}">Contact</a>
    {% elif perms.internal.organiser_tasks %}
        <a href="{% url 'internal:new_transport' %}" class="nav-link {% if request.resolver_match.url_name == 'new_transport' %}active-link{% endif %}">Új szállítás felvétele</a>
        <a href="{% url 'internal:vehicle_settings' %}" class="nav-link {% if request.resolver_match.url_name == 'vehicle_settings' %}active-link{% endif %}">Járművek kezelése</a>
        <a href="{% url 'internal:warehouse_settings' %}" class="nav-link {% if request.resolver_match.url_name == 'warehouse_settings' %}active-link{% endif %}">Raktárok kezelése</a>
        <a href="{% url 'internal:new_route' %}" class="nav-link {% if request.resolver_match.url_name == 'new_route' %}active-link{% endif %}">Új útvonal felvétele</a>
        <a href="{% url 'internal_dm:dashboards' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboards' %}active-link{% endif %}">Kimutatások</a>    
    {% elif perms.internal.driver_tasks %}
        <a href="{% url 'internal:vehicle_settings' %}" class="nav-link {% if request.resolver_match.url_name == 'vehicle_settings' %}active-link{% endif %}">Járművek kezelése</a>
        <a href="{% url 'internal:shipments' %}" class="nav-link {% if request.resolver_match.url_name == 'shipments' %}active-link{% endif %}">Fuvar nyilvántartása</a>
    {% elif perms.internal.warehouseman_tasks %}
        <a href="{% url 'internal:vehicle_settings' %}" class="nav-link {% if request.resolver_match.url_name == 'vehicle_settings' %}active-link{% endif %}">Járművek kezelése</a>
        <a href="{% url 'internal:warehouse_settings' %}" class="nav-link {% if request.resolver_match.url_name == 'warehouse_settings' %}active-link{% endif %}">Raktárok kezelése</a>        
    {% elif perms.internal.manager_tasks %}
        <a href="{% url 'internal_dm:dashboards' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboards' %}active-link{% endif %}">Kimutatások</a>    
    {% endif %}
</div>

<script>
function toggleDropdown() {
    document.querySelector('.dropdown').classList.toggle('show');
}

// Close dropdown if clicked outside
window.onclick = function(event) {
    if (!event.target.matches('.user-icon')) {
        let dropdowns = document.getElementsByClassName("dropdown");
        for (let i = 0; i < dropdowns.length; i++) {
            dropdowns[i].classList.remove('show');
        }
    }
}
</script>