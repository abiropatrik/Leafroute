{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'theme/css/editdata.css' %}?v=3">
{% endblock %}

{% block title %}Új szállítás felvétele{% endblock %}

{% block content %}
<div class="container">
    <!-- Messages -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <h1 class="page-title">Új szállítás felvétele</h1>

    <div class="upload-container">
   
        <!-- Manual Entry Section -->
        <div class="create-card">
            <h2 class="card-title">Új szállítás hozzáadása manuálisan</h2>
            <form method="post" class="form">
                {% csrf_token %}
                <div class="form-group">
                    {{ order_form.warehouse_connection.label_tag }}
                    {{ order_form.warehouse_connection }}
                </div>
                <div class="form-group">
                    {{ order_form.product.label_tag }}
                    {{ order_form.product }}
                </div>
                <div class="form-group">
                    {{ order_form.quantity.label_tag }}
                    {{ order_form.quantity }}
                </div>
                <button type="submit" class="btn btn-primary">Útvonal hozzáadása</button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const warehouseConnectionSelect = document.getElementById('id_warehouse_connection');
    const productSelect = document.getElementById('id_product');

    warehouseConnectionSelect.addEventListener('change', function() {
        const warehouseConnectionId = this.value;

        productSelect.innerHTML = '<option value="">Loading...</option>';

        if (warehouseConnectionId) {
            fetch("{% url 'internal:ajax_load_products' %}?warehouse_connection=" + warehouseConnectionId)
                .then(response => response.json())
                .then(data => {
                    productSelect.innerHTML = '';  //clear
                    if (data.products.length > 0) {
                        data.products.forEach(prod => {
                            const option = document.createElement('option');
                            option.value = prod.id;
                            option.textContent = prod.name;
                            productSelect.appendChild(option);
                        });
                    } else {
                        productSelect.innerHTML = '<option value="">No products available</option>';
                    }
                })
                .catch(error => {
                    console.error('Error loading products:', error);
                    productSelect.innerHTML = '<option value="">Error loading products</option>';
                });
        } else {
            productSelect.innerHTML = '<option value="">Select a warehouse connection first</option>';
        }
    });
});
</script>



{% endblock %}